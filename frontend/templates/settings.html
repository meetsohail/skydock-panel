{% extends "base.html" %}

{% block title %}Settings - SkyDock Panel{% endblock %}
{% block page_title %}Settings{% endblock %}

{% block content %}
<div x-data="settings()" x-init="loadSSHProfile()" class="space-y-6">
    <!-- SSH Profile Settings -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">SSH Profile</h3>
        <form @submit.prevent="saveSSHProfile()" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">SSH Username</label>
                <input type="text" x-model="sshProfile.ssh_username" required
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Authentication Type</label>
                <select x-model="sshProfile.auth_type" required
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="password">Password</option>
                    <option value="private_key">Private Key</option>
                </select>
            </div>
            <div x-show="sshProfile.auth_type === 'password'">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">SSH Password</label>
                <input type="password" x-model="sshProfile.ssh_password"
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            </div>
            <div x-show="sshProfile.auth_type === 'private_key'">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">SSH Private Key</label>
                <textarea x-model="sshProfile.ssh_private_key" rows="6"
                          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm"></textarea>
            </div>
            <button type="submit" 
                    class="px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md">
                Save SSH Profile
            </button>
        </form>
    </div>

    <!-- General Settings -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">General Settings</h3>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Panel Port</label>
                <input type="number" value="8080" disabled
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400">
                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Configured during installation</p>
            </div>
        </div>
    </div>
</div>

<script>
function settings() {
    return {
        sshProfile: {
            ssh_username: 'root',
            auth_type: 'password',
            ssh_password: '',
            ssh_private_key: ''
        },
        loadSSHProfile() {
            fetch('/api/auth/ssh-profile/')
                .then(response => response.json())
                .then(data => {
                    if (data.id) {
                        this.sshProfile = data;
                    }
                })
                .catch(error => {
                    console.error('Error loading SSH profile:', error);
                });
        },
        saveSSHProfile() {
            fetch('/api/auth/ssh-profile/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': this.getCookie('csrftoken')
                },
                body: JSON.stringify(this.sshProfile)
            })
            .then(response => response.json())
            .then(data => {
                if (data.id) {
                    alert('SSH profile saved successfully!');
                } else {
                    alert('Error: ' + (data.error || 'Failed to save SSH profile'));
                }
            })
            .catch(error => {
                console.error('Error saving SSH profile:', error);
                alert('Error saving SSH profile');
            });
        },
        getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    }
}
</script>
{% endblock %}

